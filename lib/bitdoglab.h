#ifndef _BITDOGLAB_H
#define _BITDOGLAB_H

// Blibiotecas utilizadas
#include "lib/led_matrix.pio.h"

#include "pico/stdlib.h"
#include "hardware/i2c.h"
#include "hardware/pio.h"

#include <stdio.h>
#include <stdlib.h>

// Níveis de tensão
#define LOW 0
#define HIGH 1

// Total de LEDS na matriz
#define LED_MATRIX_ITEM_TOTAL 25

// Constantes de cores
#define NO_COLOR 0x00000000
#define DIM_WHITE_COLOR 0x00040404

// Pinos utilizados
#define A_BUTTON_PIN 5
#define B_BUTTON_PIN 6
#define LED_MATRIX_PIN 7
#define GREEN_LED_PIN 11
#define BLUE_LED_PIN 12
#define RED_LED_PIN 13
#define OLED_DISPLAY_SDA_PIN 14
#define OLED_DISPLAY_SCL_PIN 15

// Constantes para PIO
#define STATE_MACHINE 0
#define LED_MATRIX_PIO pio0

// Constantes para Display OLED
#define OLED_I2C_HARDWARE_BLOCK i2c1
#define OLED_DISPLAY_WIDTH 128
#define OLED_DISPLAY_HEIGHT 64
#define OLED_DISPLAY_BAUD_RATE 115200
#define OLED_DISPLAY_I2C_ADDRESS 0x3C

// Constantes de tempo
#define DELAY_TIME 100
#define DEBOUNCE_TIME 250
#define CURRENT_TIME to_ms_since_boot(get_absolute_time())

// Comandos do Display OLED
typedef enum ssd1306_command
{
    SET_CONTRAST = 0x81,
    SET_ENTIRE_ON = 0xA4,
    SET_NORM_INV = 0xA6,
    SET_DISP = 0xAE,
    SET_MEM_ADDR = 0x20,
    SET_COL_ADDR = 0x21,
    SET_PAGE_ADDR = 0x22,
    SET_DISP_START_LINE = 0x40,
    SET_SEG_REMAP = 0xA0,
    SET_MUX_RATIO = 0xA8,
    SET_COM_OUT_DIR = 0xC0,
    SET_DISP_OFFSET = 0xD3,
    SET_COM_PIN_CFG = 0xDA,
    SET_DISP_CLK_DIV = 0xD5,
    SET_PRECHARGE = 0xD9,
    SET_VCOM_DESEL = 0xDB,
    SET_CHARGE_PUMP = 0x8D
} ssd1306_command_t;

// Estrutura de dados do Display OLED
typedef struct ssd1306
{
    unsigned char width, height, pages, address;
    i2c_inst_t *i2c_port;
    bool external_vcc;
    unsigned char *ram_buffer;
    unsigned int bufsize;
    unsigned char port_buffer[2];
} ssd1306_t;

// Variáveis globais
static unsigned long last_event_time;
static char character;

static char green_string[] = "Green:      ";
static char blue_string[] = "Blue:       ";
static char character_string[] = "Character:  ";

static ssd1306_t ssd1306;

// Matriz sem design
static const unsigned char base_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 0, 0, 0, 0,
    0, 0, 0, 0, 0,
    0, 0, 0, 0, 0,
    0, 0, 0, 0, 0,
    0, 0, 0, 0, 0};

// Matrizes com design de dígitos de 0 a 9
static const unsigned char zero_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 1, 0,
    0, 1, 0, 1, 0,
    0, 1, 0, 1, 0,
    0, 1, 0, 1, 0,
    0, 1, 1, 1, 0};

static const unsigned char one_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 0, 0,
    0, 0, 1, 0, 0,
    0, 0, 1, 0, 0,
    0, 0, 1, 0, 0,
    0, 1, 1, 1, 0};

static const unsigned char two_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 1, 0,
    0, 1, 0, 0, 0,
    0, 1, 1, 1, 0,
    0, 0, 0, 1, 0,
    0, 1, 1, 1, 0};

static const unsigned char three_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 1, 0,
    0, 1, 0, 0, 0,
    0, 1, 1, 1, 0,
    0, 1, 0, 0, 0,
    0, 1, 1, 1, 0};

static const unsigned char four_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 0, 1, 0,
    0, 1, 0, 1, 0,
    0, 1, 1, 1, 0,
    0, 1, 0, 0, 0,
    0, 0, 0, 1, 0};

static const unsigned char five_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 1, 0,
    0, 0, 0, 1, 0,
    0, 1, 1, 1, 0,
    0, 1, 0, 0, 0,
    0, 1, 1, 1, 0};

static const unsigned char six_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 1, 0,
    0, 1, 0, 0, 0,
    0, 1, 1, 1, 0,
    0, 1, 0, 1, 0,
    0, 1, 1, 1, 0};

static const unsigned char seven_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 1, 0,
    0, 1, 0, 0, 0,
    0, 0, 0, 1, 0,
    0, 1, 0, 0, 0,
    0, 0, 0, 1, 0};

static const unsigned char eight_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 1, 0,
    0, 1, 0, 1, 0,
    0, 1, 1, 1, 0,
    0, 1, 0, 1, 0,
    0, 1, 1, 1, 0};

static const unsigned char nine_matrix[LED_MATRIX_ITEM_TOTAL] = {
    0, 1, 1, 1, 0,
    0, 1, 0, 1, 0,
    0, 1, 1, 1, 0,
    0, 1, 0, 0, 0,
    0, 1, 1, 1, 0};

// Fonte utilizada
static unsigned char font_set[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // <space>
    0x00, 0x00, 0x00, 0x00, 0x5F, 0x00, 0x00, 0x00, // !
    0x00, 0x00, 0x00, 0x03, 0x00, 0x03, 0x00, 0x00, // "
    0x00, 0x24, 0x7E, 0x24, 0x24, 0x7E, 0x24, 0x00, // #
    0x00, 0x2E, 0x2A, 0x7F, 0x2A, 0x3A, 0x00, 0x00, // $
    0x00, 0x46, 0x26, 0x10, 0x08, 0x64, 0x62, 0x00, // %
    0x00, 0x20, 0x54, 0x4A, 0x54, 0x20, 0x50, 0x00, // &
    0x00, 0x00, 0x00, 0x04, 0x02, 0x00, 0x00, 0x00, // '
    0x00, 0x00, 0x00, 0x3C, 0x42, 0x00, 0x00, 0x00, // (
    0x00, 0x00, 0x00, 0x42, 0x3C, 0x00, 0x00, 0x00, // )
    0x00, 0x10, 0x54, 0x38, 0x54, 0x10, 0x00, 0x00, // *
    0x00, 0x10, 0x10, 0x7C, 0x10, 0x10, 0x00, 0x00, // +
    0x00, 0x00, 0x00, 0x80, 0x60, 0x00, 0x00, 0x00, // ,
    0x00, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x00, // -
    0x00, 0x00, 0x00, 0x60, 0x60, 0x00, 0x00, 0x00, // .
    0x00, 0x40, 0x20, 0x10, 0x08, 0x04, 0x00, 0x00, // /
    0x3C, 0x62, 0x52, 0x4A, 0x46, 0x3C, 0x00, 0x00, // 0
    0x44, 0x42, 0x7E, 0x40, 0x40, 0x00, 0x00, 0x00, // 1
    0x64, 0x52, 0x52, 0x52, 0x52, 0x4C, 0x00, 0x00, // 2
    0x24, 0x42, 0x42, 0x4A, 0x4A, 0x34, 0x00, 0x00, // 3
    0x30, 0x28, 0x24, 0x7E, 0x20, 0x20, 0x00, 0x00, // 4
    0x2E, 0x4A, 0x4A, 0x4A, 0x4A, 0x32, 0x00, 0x00, // 5
    0x3C, 0x4A, 0x4A, 0x4A, 0x4A, 0x30, 0x00, 0x00, // 6
    0x02, 0x02, 0x62, 0x12, 0x0A, 0x06, 0x00, 0x00, // 7
    0x34, 0x4A, 0x4A, 0x4A, 0x4A, 0x34, 0x00, 0x00, // 8
    0x0C, 0x52, 0x52, 0x52, 0x52, 0x3C, 0x00, 0x00, // 9
    0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00, // :
    0x00, 0x00, 0x80, 0x64, 0x00, 0x00, 0x00, 0x00, // ;
    0x00, 0x00, 0x10, 0x28, 0x44, 0x00, 0x00, 0x00, // <
    0x00, 0x28, 0x28, 0x28, 0x28, 0x28, 0x00, 0x00, // =
    0x00, 0x00, 0x44, 0x28, 0x10, 0x00, 0x00, 0x00, // >
    0x00, 0x04, 0x02, 0x02, 0x52, 0x0A, 0x04, 0x00, // ?
    0x00, 0x3C, 0x42, 0x5A, 0x56, 0x5A, 0x1C, 0x00, // @
    0x7C, 0x12, 0x12, 0x12, 0x12, 0x7C, 0x00, 0x00, // A
    0x7E, 0x4A, 0x4A, 0x4A, 0x4A, 0x34, 0x00, 0x00, // B
    0x3C, 0x42, 0x42, 0x42, 0x42, 0x24, 0x00, 0x00, // C
    0x7E, 0x42, 0x42, 0x42, 0x24, 0x18, 0x00, 0x00, // D
    0x7E, 0x4A, 0x4A, 0x4A, 0x4A, 0x42, 0x00, 0x00, // E
    0x7E, 0x0A, 0x0A, 0x0A, 0x0A, 0x02, 0x00, 0x00, // F
    0x3C, 0x42, 0x42, 0x52, 0x52, 0x34, 0x00, 0x00, // G
    0x7E, 0x08, 0x08, 0x08, 0x08, 0x7E, 0x00, 0x00, // H
    0x00, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x00, 0x00, // I
    0x30, 0x40, 0x40, 0x40, 0x40, 0x3E, 0x00, 0x00, // J
    0x7E, 0x08, 0x08, 0x14, 0x22, 0x40, 0x00, 0x00, // K
    0x7E, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x00, // L
    0x7E, 0x04, 0x08, 0x08, 0x04, 0x7E, 0x00, 0x00, // M
    0x7E, 0x04, 0x08, 0x10, 0x20, 0x7E, 0x00, 0x00, // N
    0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00, 0x00, // O
    0x7E, 0x12, 0x12, 0x12, 0x12, 0x0C, 0x00, 0x00, // P
    0x3C, 0x42, 0x52, 0x62, 0x42, 0x3C, 0x00, 0x00, // Q
    0x7E, 0x12, 0x12, 0x12, 0x32, 0x4C, 0x00, 0x00, // R
    0x24, 0x4A, 0x4A, 0x4A, 0x4A, 0x30, 0x00, 0x00, // S
    0x02, 0x02, 0x02, 0x7E, 0x02, 0x02, 0x02, 0x00, // T
    0x3E, 0x40, 0x40, 0x40, 0x40, 0x3E, 0x00, 0x00, // U
    0x1E, 0x20, 0x40, 0x40, 0x20, 0x1E, 0x00, 0x00, // V
    0x3E, 0x40, 0x20, 0x20, 0x40, 0x3E, 0x00, 0x00, // W
    0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x00, 0x00, // X
    0x02, 0x04, 0x08, 0x70, 0x08, 0x04, 0x02, 0x00, // Y
    0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x00, 0x00, // Z
    0x00, 0x00, 0x7E, 0x42, 0x42, 0x00, 0x00, 0x00, // [
    0x00, 0x04, 0x08, 0x10, 0x20, 0x40, 0x00, 0x00, // <backslash>
    0x00, 0x00, 0x42, 0x42, 0x7E, 0x00, 0x00, 0x00, // ]
    0x00, 0x08, 0x04, 0x7E, 0x04, 0x08, 0x00, 0x00, // ^
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, // _
    0x3C, 0x42, 0x99, 0xA5, 0xA5, 0x81, 0x42, 0x3C, // `
    0x00, 0x20, 0x54, 0x54, 0x54, 0x78, 0x00, 0x00, // a
    0x00, 0x7E, 0x48, 0x48, 0x48, 0x30, 0x00, 0x00, // b
    0x00, 0x00, 0x38, 0x44, 0x44, 0x44, 0x00, 0x00, // c
    0x00, 0x30, 0x48, 0x48, 0x48, 0x7E, 0x00, 0x00, // d
    0x00, 0x38, 0x54, 0x54, 0x54, 0x48, 0x00, 0x00, // e
    0x00, 0x00, 0x00, 0x7C, 0x0A, 0x02, 0x00, 0x00, // f
    0x00, 0x18, 0xA4, 0xA4, 0xA4, 0xA4, 0x7C, 0x00, // g
    0x00, 0x7E, 0x08, 0x08, 0x08, 0x70, 0x00, 0x00, // h
    0x00, 0x00, 0x00, 0x48, 0x7A, 0x40, 0x00, 0x00, // i
    0x00, 0x00, 0x40, 0x80, 0x80, 0x7A, 0x00, 0x00, // j
    0x00, 0x7E, 0x18, 0x24, 0x40, 0x00, 0x00, 0x00, // k
    0x00, 0x00, 0x00, 0x3E, 0x40, 0x40, 0x00, 0x00, // l
    0x00, 0x7C, 0x04, 0x78, 0x04, 0x78, 0x00, 0x00, // m
    0x00, 0x7C, 0x04, 0x04, 0x04, 0x78, 0x00, 0x00, // n
    0x00, 0x38, 0x44, 0x44, 0x44, 0x38, 0x00, 0x00, // o
    0x00, 0xFC, 0x24, 0x24, 0x24, 0x18, 0x00, 0x00, // p
    0x00, 0x18, 0x24, 0x24, 0x24, 0xFC, 0x80, 0x00, // q
    0x00, 0x00, 0x78, 0x04, 0x04, 0x04, 0x00, 0x00, // r
    0x00, 0x48, 0x54, 0x54, 0x54, 0x20, 0x00, 0x00, // s
    0x00, 0x00, 0x04, 0x3E, 0x44, 0x40, 0x00, 0x00, // t
    0x00, 0x3C, 0x40, 0x40, 0x40, 0x3C, 0x00, 0x00, // u
    0x00, 0x0C, 0x30, 0x40, 0x30, 0x0C, 0x00, 0x00, // v
    0x00, 0x3C, 0x40, 0x38, 0x40, 0x3C, 0x00, 0x00, // w
    0x00, 0x44, 0x28, 0x10, 0x28, 0x44, 0x00, 0x00, // x
    0x00, 0x1C, 0xA0, 0xA0, 0xA0, 0x7C, 0x00, 0x00, // y
    0x00, 0x44, 0x64, 0x54, 0x4C, 0x44, 0x00, 0x00, // z
    0x00, 0x08, 0x08, 0x76, 0x42, 0x42, 0x00, 0x00, // {
    0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00, // |
    0x00, 0x42, 0x42, 0x76, 0x08, 0x08, 0x00, 0x00, // }
    0x00, 0x00, 0x04, 0x02, 0x04, 0x02, 0x00, 0x00, // ~
};

// Declaração das funções básicas

extern unsigned long get_color_data(unsigned long color);
extern void pio_write_data(PIO pio, unsigned int state_machine, unsigned long color_data);
extern void set_led_matrix_data(unsigned long color, const unsigned char *matrix_design);
extern void set_matrix_design(unsigned char character);
extern void gpio_irq_callback(unsigned int gpio, unsigned long events);

// Declaração das funções do Display OLED

void ssd1306_init(ssd1306_t *ssd, unsigned char width, unsigned char height, bool external_vcc, unsigned char address, i2c_inst_t *i2c);
void ssd1306_config(ssd1306_t *ssd);
void ssd1306_command(ssd1306_t *ssd, unsigned char command);
void ssd1306_send_data(ssd1306_t *ssd);
void ssd1306_pixel(ssd1306_t *ssd, unsigned char x, unsigned char y, bool value);
void ssd1306_fill(ssd1306_t *ssd, bool value);
void ssd1306_rect(ssd1306_t *ssd, unsigned char top, unsigned char left, unsigned char width, unsigned char height, bool value, bool fill);
void ssd1306_line(ssd1306_t *ssd, unsigned char x0, unsigned char y0, unsigned char x1, unsigned char y1, bool value);
void ssd1306_hline(ssd1306_t *ssd, unsigned char x0, unsigned char x1, unsigned char y, bool value);
void ssd1306_vline(ssd1306_t *ssd, unsigned char x, unsigned char y0, unsigned char y1, bool value);
void ssd1306_draw_char(ssd1306_t *ssd, char c, unsigned char x, unsigned char y);
void ssd1306_draw_string(ssd1306_t *ssd, const char *str, unsigned char x, unsigned char y);

#endif /* _BITDOGLAB_H */
